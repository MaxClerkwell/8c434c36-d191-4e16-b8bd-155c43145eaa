\documentclass{dcbl/challenge}

\setdoctitle{Der Titel meines Dokuments}
\setdocauthor{Stephan Bökelmann}
\setdocemail{sboekelmann@ep1.rub.de}
\setdocinstitute{AG Physik der Hadronen und Kerne}


\begin{document}


We have observed that compiling code on our local machines can be quite challenging, primarily because our resources are limited and may not meet our requirements. It is essential to explore methods of programming on machines other than our local ones.

You might be familiar with the SSH protocol. In the late nineties, Tatu Ylönen developed this advanced remote connection protocol, which became the successor to Telnet. Before SSH, major vulnerabilities in Telnet were exploited. SSH stands for Secure Shell and quickly became the preferred protocol for secure remote connections to Unix-like systems.

\section*{Exercise}
\begin{aufgabe}
    \item To utilize the SSH service, we must ensure that \texttt{openssh-server} is installed on both the host systems. In your command line, try executing the command \texttt{sudo apt update} followed by \texttt{sudo apt install openssh-server}. Nowadays, the SSH server comes by default in most Linux distributions. However, it is always better to check if our host system meets all the requirements.

    \item Now, execute \texttt{sudo systemctl start ssh} followed by \texttt{sudo systemctl enable ssh}. Each time you boot the host system, the SSH server will also start, ensuring it is always ready.

    \item After confirming that OpenSSH is installed, we can proceed to log onto a client system. Type \texttt{ssh student@49.12.40.53}. A dialogue should open, asking for an authentication password: \texttt{hck2994kls#9}.
    
    \item Before diving into the details, let's take a step back and recap what exactly happened. As we entered the SSH command to connect to the client server, we defined several things without realizing it. To establish a successful remote connection between two systems, the SSH protocol uses one outgoing port on the host system and one incoming port on the client system, by default, Port 22. If we do not explicitly provide the flag \texttt{-p <port>}, for example, \texttt{-p 1793} in the SSH command, the default port will be used. Since using defaults can sometimes pose a security risk, you should always configure a custom port by editing the system file \texttt{/etc/ssh/sshd\_config}. Ensure the user has the necessary permissions. After changing the system's SSH port, you need to specify the port every time you attempt to log onto the client system.

    \item However, this is still not considered "best practice." In a production environment, the only correct way to log onto a client system using SSH is by connecting via an SSH key. An SSH key is always an asymmetric key pair. The private key remains on the host system, and the public key is transferred to the client system. Do the following steps:
    \begin{enumerate}
        \item To generate an SSH key on our local machine, prompt the command \texttt{ssh-keygen -t rsa -b 4096}. The \texttt{-t rsa} option tells the program \texttt{ssh-keygen} to use the RSA cipher to create a key pair. The \texttt{-b 4096} option sets the bit length of your key. While longer bit rates are more secure, data transfer will also be slower. 4096 Bits is secure enough for now.
        \item After pressing enter, the terminal will ask for a file name for the key. Type in a name of your liking.
        \item In the directory \texttt{/home/user/.ssh}, there's a file called \texttt{config}. In this file, you can specify how you would like to log into a client system. Let's define one:
        \begin{lstlisting}
            Host <client_name>
                HostName <ipv4_of_the_client_system>
                IdentityFile <path-to-your-private-key>
                #Port <custom_port>
                #User <user_you_log_into>
        \end{lstlisting}
        \item Save your configuration, and now you can connect via SSH by typing \texttt{ssh <client_name>}.
        \item To upload the public key to the client system, you can use the command \texttt{ssh-copy-id username@remote_system}. It will automatically save the public key in the \texttt{~/.ssh/authorized\_keys} file. You could also do this manually if preferred. Now, everything is set to use SSH with SSH keys.
    \end{enumerate}

    \item After successfully connecting to our client system, let's find out which system we have logged into. The first thing appearing is an empty command line stating: \texttt{student@c-Kurs:\~\$}. So we are currently in the users home directory.
        Now we want to find out the ip that our client system owns by typing \texttt{ip a}. Find the correct ipv4 address. If the client system is part of multiple networks we could check these as well. 
        By typing in \texttt{lsb_release -a} the output is going to tell us what linux distribution the system is running on. In this case it should be Debian 12.
        Knowing what distribution you are using is crutial if you want to use it to its full potential. Most important you can now research how to do specific tasks on the specific OS.
    \item A simple task to perfom is a speedtest. From your host perform: \texttt{ssh user@remote 'dd if=/dev/zero' | dd of=/dev/null}
\end{aufgabe}

\section*{Exercise for Advanced Users}
\begin{enumerate}
    \item In case you are curious about what more there is to know about SSH, take a look at the file \texttt{/etc/ssh/sshd\_config}. While experimenting with these settings, you can easily block access to your remote server, so always have a backup ready. Explore how you can limit the number of parallel SSH sessions allowed and how to restrict the number of attempts for logging into the system.

    \item For the very curious IT security experts, research the tool \texttt{fail2ban} and how to configure an IP jail.
\end{enumerate}
\end{document}
